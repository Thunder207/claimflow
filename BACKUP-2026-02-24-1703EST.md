# ClaimFlow Backup & Rollback Guide
> **Created**: 2026-02-24 17:03 EST  
> **Git SHA**: `038b2f244628d1552b13800a4a815f44628127b3`  
> **Git Tag**: `v5.1-ux-optimized-2026-02-24`  
> **Previous Tag**: `v5.0-transport-e2e-verified-2026-02-23`  
> **Branch**: `main`  
> **Live URL**: https://claimflow-e0za.onrender.com  
> **Repo**: https://github.com/Thunder207/claimflow.git  

---

## üî¥ ROLLBACK INSTRUCTIONS

```bash
# Rollback to THIS version (v5.1 ‚Äî UX optimized)
git checkout v5.1-ux-optimized-2026-02-24

# Rollback to PREVIOUS version (v5.0 ‚Äî pre-UX optimizations, transport working)
git checkout v5.0-transport-e2e-verified-2026-02-23

# Rollback to older milestones
git checkout v4.0-governance-validated-2026-02-21-1612EST   # pre-transport
git checkout v2.0-dayplanner-2026-02-19-2012EST             # Day Planner only
git checkout v1.0-stable-2026-02-19-1730EST                 # pre-Day Planner

# Force deploy the rollback to Render
git push -f origin HEAD:main
curl -X POST \
  -H "Authorization: Bearer rnd_PM94FfZa3hFY3OzBJ1Ao5j9yD0qI" \
  -H "Content-Type: application/json" \
  'https://api.render.com/v1/services/srv-d6aj99rnv86c739nt670/deploys' \
  -d '{"clearCache":"do_not_clear"}'
```

---

## üì¶ VERSION HISTORY

| Tag | Date | SHA | Description |
|-----|------|-----|-------------|
| `v5.1-ux-optimized-2026-02-24` | Feb 24 | `038b2f2` | **THIS VERSION** ‚Äî UX optimizations |
| `v5.0-transport-e2e-verified-2026-02-23` | Feb 23 | `1b2d4ee` | Smart Transport E2E verified |
| `v4.0-governance-validated-2026-02-21-1612EST` | Feb 21 | ‚Äî | Governance roles |
| `v3.0-supervisor-ui-2026-02-20-2255EST` | Feb 20 | ‚Äî | Supervisor dashboard |
| `v2.2-e2e-verified-2026-02-20-2140EST` | Feb 20 | ‚Äî | Day Planner E2E verified |
| `v2.0-dayplanner-2026-02-19-2012EST` | Feb 19 | ‚Äî | Day Planner initial |
| `v1.0-stable-2026-02-19-1730EST` | Feb 19 | ‚Äî | Original stable |

---

## üÜï CHANGES SINCE v5.0 (This Release)

### 1. AT ‚Üí Trip Transport Auto-Population
- **File**: `app.js` ‚Äî `GET /api/trips/:id` endpoint
- **What**: When employee opens a Trip, the linked AT's transport data (flight costs, route, etc.) is included in the API response
- **Effect**: `loadTdpTransport()` in frontend auto-activates Flight button and fills in $600/$600 from the AT
- **Rollback**: Revert to v5.0 ‚Äî trips will still work, users just need to manually re-enter transport data

### 2. Confirmation Dialogs
- **File**: `employee-dashboard.html` ‚Äî `dpSubmitForApproval()` and `tdpSubmitTrip()`
- **What**: `confirm()` dialog before submitting AT or Trip
- **Effect**: Prevents accidental submissions

### 3. Success Feedback + Scroll-to-Top
- **File**: `employee-dashboard.html` ‚Äî both submit functions
- **What**: Toast notification + `window.scrollTo({top: 0})` after successful submission
- **Effect**: Clear confirmation and better navigation after submit

### 4. Mobile Auto-Scroll on Transport Activation
- **File**: `employee-dashboard.html` ‚Äî `dpToggleTransport()` and `tdpToggleTransport()`
- **What**: `scrollIntoView()` when opening a transport section (Flight, Train, etc.)
- **Effect**: Mobile users see the form that just opened

### 5. Trip Status Label
- **File**: `employee-dashboard.html` ‚Äî `tdpLoadTrip()`
- **What**: "ACTIVE" badge ‚Üí "‚úèÔ∏è READY TO EDIT" with cyan color
- **Effect**: Clearer status communication

---

## üü¢ WHAT'S FULLY WORKING

### Complete End-to-End Flow
1. ‚úÖ Employee creates Travel Authorization with Day Planner + transport costs
2. ‚úÖ Employee submits AT (with confirmation dialog)
3. ‚úÖ Supervisor approves AT ‚Üí Trip auto-created
4. ‚úÖ Employee opens Trip ‚Üí **transport data auto-populates from AT** (NEW)
5. ‚úÖ Employee submits Trip (with confirmation dialog + success toast)
6. ‚úÖ Supervisor sees day-by-day breakdown with transport line items
7. ‚úÖ Supervisor approves all expenses

### Smart Transportation
- Multi-mode selection: Flight, Train, Bus, Rental Car, Personal Vehicle
- Per-mode cost entry with live subtotals
- AT ‚Üí Trip data carries over automatically
- `transport_flight`, `transport_train`, `transport_bus`, `transport_rental` expense types
- Supervisor sees specific transport breakdown

---

## üîë CREDENTIALS & ACCESS

### Render.com
- **API Key**: `rnd_PM94FfZa3hFY3OzBJ1Ao5j9yD0qI`
- **Service ID**: `srv-d6aj99rnv86c739nt670`

### Demo Logins
| Role | Email | Password |
|------|-------|----------|
| Employee | anna.lee@company.com | anna123 |
| Supervisor | lisa.brown@company.com | lisa123 |
| Employee | david.wilson@company.com | david123 |
| Supervisor | sarah.chen@company.com | sarah123 |

**‚ö†Ô∏è SQLite in-memory ‚Äî ALL DATA RESETS on Render deploy.**

---

## üìÇ KEY FILES

| File | Lines | Purpose |
|------|-------|---------|
| `app.js` | ~4570 | Backend: Express + SQLite + all API routes |
| `employee-dashboard.html` | ~7120 | Frontend: employee UI, Day Planner, transport |
| `admin.html` | ~3925 | Supervisor dashboard |
| `CONTINUITY.md` | ‚Äî | Quick-start recovery (architecture, code locations) |
| `ARCHITECTURE.md` | ‚Äî | Deep dive (DB schema, API endpoints) |

---

## üèóÔ∏è PICKING UP FROM HERE

### For a New Developer/Agent
1. `cat CONTINUITY.md` ‚Äî architecture, credentials, code locations
2. `cat ARCHITECTURE.md` ‚Äî DB schema, API endpoints
3. `npm install && node app.js` ‚Äî run locally on port 3000
4. Login as anna.lee@company.com / anna123 to test

### ID Naming Convention (CRITICAL)
| Context | Prefix | Example |
|---------|--------|---------|
| AT Creation Modal | `at-` | `at-flight-dep` |
| AT Day Planner | `dp-` | `dp-flight-dep` |
| Trip Day Planner | `tdp-` | `tdp-flight-dep` |

### Common Pitfalls
1. Never mix AT/Trip transport IDs (at-/dp-/tdp- prefixes)
2. Don't trust `dpState.transport` ‚Äî read DOM directly in submit functions
3. Add new expense types to `validExpenseTypes` in app.js (~line 3856)
4. SQLite resets on deploy ‚Äî test data is ephemeral
5. Never claim "fixed" without user testing

---

## üìã OPEN ITEMS

| Priority | Item | Notes |
|----------|------|-------|
| Low | `est_transport` supervisor AT summary | Shows $0, but actual expense records are correct |
| Low | Hotel receipt upload processing | UI exists, backend may be incomplete |
| Future | PostgreSQL for persistence | SQLite is ephemeral |
| Future | Email notifications on submit | |
| Future | PDF expense report export | |
